<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon/favicon-16x16.png"
    />
    <link
      rel="mask-icon"
      href="/images/favicon/safari-pinned-tab.svg"
      color="#409fba"
    />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta name="theme-color" content="#ffffff" />
    <meta
      property="og:title"
      content="The Educational Opportunity Project at Stanford"
    />
    <meta
      property="og:description"
      content="Use our visualizations to explore educational opportunity in your school & community."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="%PUBLIC_URL%" />
    <meta
      property="og:image"
      content="%PUBLIC_URL%/social-image-01.png"
    />
    <!-- Google Tag Manager -->
    <script>
      if (
        window.location.hash.indexOf('/embed/') === -1 &&
        window.location.hostname !== 'localhost'
      ) {
        ;(function(w, d, s, l, i) {
          w[l] = w[l] || []
          w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
          })
          var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != 'dataLayer' ? '&l=' + l : ''
          j.async = true
          j.src =
            'https://www.googletagmanager.com/gtm.js?id=' +
            i +
            dl
          f.parentNode.insertBefore(j, f)
        })(
          window,
          document,
          'script',
          'dataLayer',
          'GTM-5RMFK5W'
        )
      } else {
        window.dataLayer = (function() {
          return { push: function() {} }
        })()
      }
    </script>
    <!-- End Google Tag Manager -->
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>
      Opportunity Explorer | The Educational Opportunity Project
      at Stanford University
    </title>
    <style>
      :root {
        /** Shade */
        --darken1: rgba(0, 0, 0, 0.05);
        --darken2: rgba(0, 0, 0, 0.15);
        --darken3: rgba(0, 0, 0, 0.24);
        --darken4: rgba(0, 0, 0, 0.37);

        /** Brighten */
        --lighten1: rgba(255, 255, 255, 0.05);
        --lighten2: rgba(255, 255, 255, 0.15);

        /** Colors */
        --primary: #083794;
        --link: #0078d4;
        --accent: #ff003e;
        --text: #031232;
        --text2: #5d5d5d;
        --text3: #757575;
        --alt-text: #fff;
        --background: #fff;
        --dark-background: rgba(3, 18, 50, 0.9);
        --alt-background: #f5f8fa;
        --highlight-background: #ebfbff;
        --footer-background: #f8f8f8;

        --body-text: var(--text);
        --body2-text: var(--text2);
        --link-text: var(--link);
        --tab-text: var(--primary);
        --accent2: #1b64ac;
        --accent3: #34bfef;
        --accent4: rgb(177, 216, 206);
        --divider: #eceff1;
        --grey0: #f8f8f8;
        --grey1: #efefef;
        --grey2: #dcdcdc;
        --grey3: #999;

        /** Margins and spacing */
        --grid-unit: 8px;
        --padding: 16px;
        --page-margin: 16px;

        /** Typography */
        --font: maisonneue-book, lato, helvetica neue, Arial,
          sans-serif, -apple-system;
        --body-font: maisonneue-book, lato, helvetica neue, Arial,
          sans-serif, -apple-system;
        --body-bold: maisonneue-bold, lato, helvetica neue, Arial,
          sans-serif, -apple-system;
        --body-italic: maisonneue-italic, helvetica neue, Arial,
          sans-serif, -apple-system;
        --heading-font: sharpgrotesk-medium20, lato,
          helvetica neue, Arial, sans-serif, -apple-system;
        --alt-font: sharpgrotesk-medium15, lato, helvetica neue,
          Arial, sans-serif, -apple-system;
        --font-size: 0.875rem; /** 14px */
        --base-font-size: var(--font-size); /** 14px */
        --large-font-size: 1rem;
        --small-font-size: 0.8125rem; /** 13px */
        --mini-font-size: 0.78125rem; /** 12.5px */
        --micro-font-size: 0.6875rem; /** 11px */
        --body-font-size: 1rem;
        --header-title-size: 0.875em;
        --header-subheader-size: 0.875em;

        /** Layout Sizes */
        --header-height: 104px;
        --header-row1-height: 64px;
        --header-row2-height: 40px;
        --menu-width: 320px;
        --help-panel-width: 320px;
        --locations-bar-height: 64px;
        --footer-height: 40px;
        --panel-width: 296px;
        --scatterplot-heading: 56px;

        /** Shadows */
        --shadow1: 0 0 1px rgba(0, 0, 0, 0.08),
          1px 1px 2px rgba(0, 0, 0, 0.05);
        --shadow10: 0 0 1.5px rgba(0, 0, 0, 0.1),
          4px 4px 4px rgba(0, 0, 0, 0.05);
        --shadow100: 0 0 4px rgba(0, 0, 0, 0.15),
          4px 4px 8px rgba(0, 0, 0, 0.1);

        --divider-border: 1px solid var(--divider);

        /** Scatterplot Margins */
        --sp-top: 24px;
        --sp-right: 64px;
        --sp-left: 24px;
        --sp-bottom: 24px;

        /** Preview Margins */
        --sp-prev-top: 8px;
        --sp-prev-right: 8px;
        --sp-prev-left: 8px;
        --sp-prev-bottom: 8px;
      }

      /** Variable overrides for 1023px and above */
      @media (min-width: 1023px) {
        :root {
          /** Margins and spacing */
          --page-margin: 16px;

          /** Typography */
          --base-font-size: 16px;
        }
      }

      @font-face {
        font-family: maisonneue-bold;
        src: url('/assets/fonts/MaisonNeue-Bold.woff2')
            format('woff2'),
          url('/assets/fonts/MaisonNeue-Bold.woff')
            format('woff');
      }

      @font-face {
        font-family: maisonneue-book;
        src: url('/assets/fonts/MaisonNeue-Book.woff2')
            format('woff2'),
          url('/assets/fonts/MaisonNeue-Book.woff')
            format('woff');
      }

      @font-face {
        font-family: maisonneue-italic;
        src: url('/assets/fonts/MaisonNeue-BookItalic.woff2')
            format('woff2'),
          url('/assets/fonts/MaisonNeue-BookItalic.woff')
            format('woff');
      }

      @font-face {
        font-family: sharpgrotesk-medium15;
        src: url('/assets/fonts/SharpGroteskMedium15.woff2')
            format('woff2'),
          url('/assets/fonts/SharpGroteskMedium15.woff')
            format('woff');
      }

      @font-face {
        font-family: sharpgrotesk-medium20;
        src: url('/assets/fonts/SharpGroteskMedium20.woff2')
            format('woff2'),
          url('/assets/fonts/SharpGroteskMedium20.woff')
            format('woff');
      }

      html {
        font-size: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        width: 100%;
        height: 100%;
      }
      *,
      *::before,
      *::after {
        box-sizing: inherit;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: var(--body-font);
        font-weight: normal;
        color: var(--body-text);
        font-size: var(--font-size);
        width: 100%;
        height: 100%;
      }

      a {
        color: var(--link);
      }

      a:hover {
        color: var(--primary);
      }

      ul {
        margin: 0;
        padding: 0;
      }
      li {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      button .icon {
        width: 14px;
        height: 14px;
        margin-left: 8px;
      }

      .icon {
        width: 16px;
        height: 16px;
      }

      .icon.card__icon {
        width: 26px;
        height: 26px;
        margin-right: 16px;
      }

      .blocker {
        background: rgba(255, 255, 255, 0.9);
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 99999;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .blocker__message {
        padding: 16px;
        border: 2px solid #ccc;
        max-width: 300px;
        background: #fff;
      }
      @media (min-width: 900px) {
        .blocker {
          display: none;
        }
      }

      /** Intro Container */ 

      .section.section--intro {
        background: #061D56; 
        color: #fff;
        min-height: 440px;
        margin-top:0;
        padding:0 16px;
        position: absolute;
        width:100%;
        height:100%;
        top:0;
        left:0;
        z-index:10000;
        display: block;
        text-align: center;
        /* transition: transform 0.6s ease-in-out 1s; */
        transform: translate3d(0, 0, 0);
        overflow:auto;
        background-image: linear-gradient(-180deg, #061D56 3%, #04143C 84%);
        overflow: auto;
        overflow-x: hidden;
      }

      @media(min-width: 1023px) {
        .section.section--intro {
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
        }
      }

      .section.section--intro.section--hidden {
        transform: translate3d(-100%, 0, 0);
      }

      @media (prefers-reduced-motion: reduce) {
        .section.section--intro {
          transition: opacity 0.6s ease-in-out 0.4s;
          opacity:1;
        }
        .section.section--intro.section--hidden {
          transform: translate3d(0, 0, 0);
          opacity:0;
          z-index:-1;
        }
      }


      @media(min-width: 1023px) {
        .section.section--intro.section--hidden {
          transform: translate3d(0, -100%, 0);
        }
      }

      /** Intro Header */

      .section--intro .section__header {
        position:relative;
        margin: 32px auto 8px auto;
        max-width: 576px;
      }

      /** Logo Mark */

      .section__brand {
        position:relative;
        width: 32px;
        height: 35px;
      }

      @media(min-width: 1023px) {
        .section__brand {
          width: 34px;
          height: 37px;
          margin-top: -48px;
        }
      }

      /** Title */

      .section--intro .section__title {
        font-size: 18.52px;
        line-height: 27.24px;
        letter-spacing: 0.18px;
        position:relative;
      }

      .section--intro .section__title br {
        display: none;
      }

      @media(min-width: 480px) {
        .section--intro .section__title br {
          display: block;
        }
      }

      @media(min-width: 1023px) {
        .section--intro .section__title {
          font-size: 22px;
          letter-spacing: 0.22px;
          line-height: 33.59px;
        }

      }


      /** Intro Description */

      .section--intro .section__description {
        max-width: 660px;
        margin: 24px auto;
        text-align: center;
        line-height: 1.5;
        font-size: 15px;
        position:relative;
      }

      @media(min-width: 1023px) {
        .section--intro .section__description {
          margin-bottom: 48px;
          font-size: 14px;
          letter-spacing: 0.23px;
          text-align: center;
          line-height: 21px;
        }
      }

      /** Explorer Heading */
    
      .section--intro .section__heading {
        font-size: 18.5px;
        font-family: var(--heading-font);
        font-weight: normal;
        max-width: 200px;
        margin: 32px auto 24px; 
        line-height: 27px;
        letter-spacing: 0.18px;
      }

      @media(min-width: 1023px) {
        .section--intro .section__heading {
          font-size: var(--large-font-size);
          margin-bottom:0;
          max-width: none;
        }
      }

      /** Section Body */

      .section--intro .section__body {
        position: relative;
      }

      .section--intro .section__cards {
        display: flex;
        align-items: stretch;
        justify-content: center;
        flex-direction: column;
      }

      @media(min-width: 1023px) {
        .section--intro .section__cards {
          flex-direction: row;
        }
      }

      .section--intro .section__loading {
        position:absolute;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items:center;
        justify-content: flex-start;
        opacity:0;
        visibility: hidden;
        /* transition: opacity 0.4s ease; */
      }

      @media(min-width: 1023px) {
        .section--intro .section__loading {
          justify-content: flex-start;
        }
      }

      .section--intro .section__body--loading .section__loading {
        opacity: 1;
        visibility: visible;
      }

      .section--intro .loading__text {
        font-family: var(--alt-font);
        letter-spacing: 0.02em;
        color: #fff;
        text-transform: uppercase;
      }

      .section--intro .section__user-prompt {
        opacity:1;
        /* transition: opacity 0.6s ease; */
      }

      .section--intro .section__body--loading .section__user-prompt {
        opacity:0;
      }

      .section--intro .section__body--unsupported .section__user-prompt {
        display: none;
      }

      .section--intro .section__body .section__unsupported {
        display:none;
        font-family: sans-serif;
        font-size: var(--large-font-size);
        max-width: 620px;
        margin:auto;
        padding: 16px;
        background: rgba(255, 0, 0, 0.12);
        border: 1px solid #c00;
      }

      .section--intro .section__body--unsupported .section__unsupported {
        display:block;
      }

      /** Cards */

      .card {
        position:relative;
        display: flex;
        flex-direction: column;
        align-items: flex-start;        
        text-align: left;
        margin: 0 auto 32px auto;
        width: 100%;
        flex:1;
        max-width: 320px;
        min-width: 140px;
      }

      @media(min-width: 1023px) {
        .card {
          margin: 16px;
          max-width: 320px;
        }
      }

      .card__header {
        position:relative;
        z-index:9;
        width: 100%;
        flex: 0;
        text-align:center;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        padding: 0px 16px;
        min-height: 48px;
      }

      .card__title {
        font-size: 16px;
        letter-spacing: 0.16px;
        line-height: 1;
        text-transform: capitalize;
        white-space: normal;
      }

      .card__body {
        padding: 0px 16px 16px 16px;
        display: flex;
        flex-direction: column;
        flex: 1;
        align-items: flex-start;
        justify-content: stretch;
        width: 100%;
        text-align: center;
        font-size: 15px;
        letter-spacing: 0.24px;
        line-height: 22px;
      }

      @media(min-width: 1023px) {
        .card__body {
          font-size: 14px;
          color: #FFFFFF;
          letter-spacing: 0;
          text-align: center;
          line-height: 21px;
        }
      }

      .card__body p { margin: 0; }

      .card__actions {
        width:100%;
        z-index: 1;
        padding: 0 16px;
      }

      @media(min-width: 1023px) {
        .card__actions {
          top:auto;
          bottom:0;
          height: 48px;
        }
      }

      .card__actions button {
        font-family: var(--alt-font);
        font-size: 15.12px;
        letter-spacing: 0.26px;
        line-height: 18.36px;
        text-transform: uppercase;
        padding: 8px 16px;
        height: 48px;
        background: none;
        border:none;
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: center;
        color:#fff;
        border: 1px solid #fff;
        margin: 0 auto;
        border-radius: 2px;
        max-width: 264px;
      }
      .card__actions button:hover {
        cursor: pointer;
        background: rgba(255,255,255,0.15);
      }
      .card__actions button:focus {
        outline-color: #fff;
      }
      .card__actions button svg {
        width: 12px;
        height: 12px;
      }

      @media(min-width: 1023px) {
        .card__actions button {
          justify-content: center;
          font-size: 16.8px;
          letter-spacing: 0.29px;
          line-height: 20.4px;
          max-width: 88px;
        }
        .card__actions button svg {
          transform: rotate(90deg);
        }
      }

      /** App container */

      #root {
        position: relative;
        width: 100%;
        height:100%;
      }

      .hidden {
        visibility: hidden;
      }

      .bg {
        position: absolute;
        top: -62px;
        width: 420px;
        margin-left: -187px;
      }

      @media(min-width: 1023px) {
        .bg {
          top: -102px;
          width: 626px;
          margin-left: -297px;
        }
      }

      .bg__dots {
        fill: rgba(12,49,141,0.82);
        opacity:0.46;
      }

      .bg__mainland {
        fill: none;
        stroke-width: 0.8;
        stroke: #06287C;
        opacity:0.76;
      }

      /*!
      * Load Awesome v1.1.0 (http://github.danielcardoso.net/load-awesome/)
      * Copyright 2015 Daniel Cardoso <@DanielCardoso>
      * Licensed under MIT
      */
      .la-ball-pulse,.la-ball-pulse>div{position:relative;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.la-ball-pulse{display:block;font-size:0;color:#fff}.la-ball-pulse.la-dark{color:var(--alt-text)}.la-ball-pulse>div{display:inline-block;float:none;background-color:var(--alt-text);border:0 solid var(--alt-text)}.la-ball-pulse{width:54px;height:18px}.la-ball-pulse>div:nth-child(1){-webkit-animation-delay:-.2s;-moz-animation-delay:-.2s;-o-animation-delay:-.2s;animation-delay:-.2s}.la-ball-pulse>div:nth-child(2){-webkit-animation-delay:-.1s;-moz-animation-delay:-.1s;-o-animation-delay:-.1s;animation-delay:-.1s}.la-ball-pulse>div:nth-child(3){-webkit-animation-delay:0s;-moz-animation-delay:0s;-o-animation-delay:0s;animation-delay:0s}.la-ball-pulse>div{width:10px;height:10px;margin:4px;border-radius:100%;-webkit-animation:ball-pulse 1s ease infinite;-moz-animation:ball-pulse 1s ease infinite;-o-animation:ball-pulse 1s ease infinite;animation:ball-pulse 1s ease infinite}.la-ball-pulse.la-sm{width:26px;height:8px}.la-ball-pulse.la-sm>div{width:4px;height:4px;margin:2px}.la-ball-pulse.la-2x{width:108px;height:36px}.la-ball-pulse.la-2x>div{width:20px;height:20px;margin:8px}.la-ball-pulse.la-3x{width:162px;height:54px}.la-ball-pulse.la-3x>div{width:30px;height:30px;margin:12px}@-webkit-keyframes ball-pulse{0%,100%,60%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}30%{opacity:.1;-webkit-transform:scale(.01);transform:scale(.01)}}@-moz-keyframes ball-pulse{0%,100%,60%{opacity:1;-moz-transform:scale(1);transform:scale(1)}30%{opacity:.1;-moz-transform:scale(.01);transform:scale(.01)}}@keyframes ball-pulse{0%,100%,60%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}30%{opacity:.1;-webkit-transform:scale(.01);-moz-transform:scale(.01);-o-transform:scale(.01);transform:scale(.01)}}
    </style>
  </head>

  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-5RMFK5W"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="root"></div>
    <script>
      // test for local storage support
      window.supportsLocalStorage = (function() {
        var mod = 'test'
        try {
          localStorage.setItem(mod, mod)
          localStorage.removeItem(mod)
          return true
        } catch (e) {
          return false
        }
      })()

      // sets hash on browser for url
      function replaceHash(hash) {
        window.location.hash = hash
      }

      // switch from split view if low resolution
      if (
        window.location.hash.indexOf('/split/') > -1 &&
        window.innerWidth < 1024
      ) {
        replaceHash(
          window.location.hash.replace('/split/', '/map/')
        )
      }

      // SEDA namespace for globals
      window.SEDA = (function() {
        // grabs everything after the # character on provided string
        function getHashFromURL(url) {
          if (url.indexOf('#') === -1) {
            return ''
          }
          return url.substring(url.indexOf('#') + 1)
        }

        // listen to hash change, and show intro if empty route
        window.addEventListener(
          'hashchange',
          function(e) {
            const oldHash = getHashFromURL(e.oldURL)
            const newHash = getHashFromURL(e.newURL)
            if (newHash === '/' && oldHash.length > 0) {
              showIntro()
            }
          },
          false
        )

        // stores the browser name and version for reporting
        var browser = (function() {
          var ua = navigator.userAgent,
            tem,
            M =
              ua.match(
                /(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i
              ) || []
          if (/trident/i.test(M[1])) {
            tem = /\brv[ :]+(\d+)/g.exec(ua) || []
            return { name: 'IE', version: tem[1] || '' }
          }
          if (M[1] === 'Chrome') {
            tem = ua.match(/\b(OPR|Edge)\/(\d+)/)
            if (tem != null)
              return {
                name: tem[1].replace('OPR', 'Opera'),
                version: tem[2]
              }
          }
          M = M[2]
            ? [M[1], M[2]]
            : [navigator.appName, navigator.appVersion, '-?']
          if ((tem = ua.match(/version\/(\d+)/i)) != null)
            M.splice(1, 1, tem[1])
          return { name: M[0], version: M[1] }
        })()

        // returns true if webgl is supported
        function webgl_support() {
          try {
            var canvas = document.createElement('canvas')
            return (
              !!window.WebGLRenderingContext &&
              (canvas.getContext('webgl') ||
                canvas.getContext('experimental-webgl'))
            )
          } catch (e) {
            return false
          }
        }

        // returns true if the browser is internet explorer
        function isIE() {
          var ua = window.navigator.userAgent
          var msie = ua.indexOf('MSIE ')
          if (msie > 0) {
            // IE 10 or older => return version number
            return parseInt(
              ua.substring(msie + 5, ua.indexOf('.', msie)),
              10
            )
          }
          var trident = ua.indexOf('Trident/')
          if (trident > 0) {
            // IE 11 => return version number
            var rv = ua.indexOf('rv:')
            return parseInt(
              ua.substring(rv + 3, ua.indexOf('.', rv)),
              10
            )
          }
          return false
        }

        // returns true if the browser is not supported
        function unsupportedBrowser() {
          return !webgl_support() || isIE()
        }

        // returns true if the provided route is valid
        function validRoute(route) {
          if (route[0] === '/') {
            route = route.substring(1)
          } else if (route[0] === '#') {
            route = route.substring(2)
          }
          // skip embed validation
          if (route.indexOf('embed/') !== -1) {
            return true
          }
          var parts = route.split('/')
          var routeIds = [
            'view',
            'highlightedState',
            'region',
            'metric',
            'secondary',
            'demographic',
            'zoom',
            'latitude',
            'longitude',
            'locations'
          ]
          const params = routeIds.reduce(function(acc, curr, i) {
            acc[curr] = parts[i]
            return acc
          }, {})
          if (
            !params.view ||
            ['map', 'chart', 'split'].indexOf(params.view) === -1
          ) {
            return false
          }
          if (
            !params.highlightedState ||
            params.highlightedState.length !== 2
          ) {
            return false
          }
          if (
            !params.region ||
            [
              'states',
              'counties',
              'districts',
              'schools'
            ].indexOf(params.region) === -1
          ) {
            return false
          }
          if (
            !params.metric ||
            ['avg', 'grd', 'coh'].indexOf(params.metric) === -1
          ) {
            return false
          }
          if (
            !params.secondary ||
            ['ses', 'seg', 'min', 'frl'].indexOf(
              params.secondary
            ) === -1
          ) {
            return false
          }
          if (
            !params.demographic ||
            (params.demographic !== 'all' &&
              params.region === 'schools') ||
            [
              'all',
              'w',
              'b',
              'a',
              'h',
              'i',
              'm',
              'f',
              'p',
              'wb',
              'wh',
              'pn',
              'np',
              'mf',
              'wi'
            ].indexOf(params.demographic) === -1
          ) {
            return false
          }
          if (
            !params.zoom ||
            !params.latitude ||
            !params.longitude
          ) {
            return false
          }
          return true
        }

        // default route to load if none specified, or invalid
        var defaultRoute =
          '/map/none/counties/avg/ses/all/3.15/37.39/-96.78'

        // track start time
        var startTime = new Date()

        // variable to track the time when a user enters a view
        var viewTime

        // variable to track the current view (map, chart, split)
        var currentView

        // variable to track the time when a user selects a metric
        var metricTime

        // variable to track the current metric (avg, grd, coh)
        var currentMetric

        // track time after metric selection
        var startTimeDataLoad

        // timeout to track long load times
        var loadTimeout

        // stores event handlers
        var handlers = {}

        // labels for tracking
        var LANG = {
          ALL: 'all',
          B: 'Black',
          W: 'White',
          H: 'Hispanic',
          A: 'Asian',
          M: 'male',
          F: 'female',
          P: 'poor',
          NP: 'non-poor',
          N: 'non-poor',
          WB: 'White / Black gap',
          WH: 'White / Hispanic gap',
          PN: 'non-poor / poor gap',
          MF: 'male / female gap',
          AVG: 'average test scores',
          GRD: 'learning rates',
          COH: 'trend in test scores'
        }

        // registers a handler for a custom event
        var addHandler = function(handlerId, handler) {
          if (!handlers.hasOwnProperty(handlerId)) {
            handlers[handlerId] = []
          }
          handlers[handlerId].push(handler)
        }

        // triggers a custom event
        var trigger = function(handlerId, data) {
          if (handlers[handlerId]) {
            handlers[handlerId].forEach(function(handler) {
              handler(data)
            })
          }
        }

        var showIntro = function() {
          var el = document.getElementsByClassName(
            'section--intro'
          )[0]
          if (el) {
            // el.parentNode.removeChild(el)
            el.setAttribute('style', '')
            el.classList.remove('section--hidden')
            document
              .getElementById('root')
              .classList.add('hidden')
            showCards()
          }
        }

        // hides the intro section and reveals the tool
        var hideIntro = function() {
          var el = document.getElementsByClassName(
            'section--intro'
          )[0]
          if (el) {
            el.classList.add('section--hidden')
            document
              .getElementById('root')
              .classList.remove('hidden')
          }
        }

        var removeIntro = function() {
          var el = document.getElementsByClassName(
            'section--intro'
          )[0]
          if (el) {
            // el.parentNode.removeChild(el)
            el.setAttribute('style', 'display:none;')
          }
        }

        // shows the cards for metric selection
        var showCards = function() {
          var el = document.getElementsByClassName(
            'section__body--loading'
          )[0]
          if (el) {
            el.classList.remove('section__body--loading')
          }
        }

        // shows a message indicating the browser is unsupported
        var showUnsupported = function() {
          var el = document.getElementsByClassName(
            'section__body--loading'
          )[0]
          if (el) {
            el.classList.remove('section__body--loading')
            el.classList.add('section__body--unsupported')
          }
        }

        // hide the cards for metric selection
        var hideCards = function() {
          var el = document.getElementsByClassName(
            'section__body'
          )[0]
          if (el) {
            el.classList.add('section__body--loading')
          }
        }

        // load view for the provided metric, set in local storage to remember
        var loadView = function(metric) {
          if (supportsLocalStorage) {
            localStorage.setItem('region', 'districts')
            localStorage.setItem('metric', metric)
            localStorage.setItem('view', 'map')
            localStorage.setItem('demographic', 'all')
          }
          loadRoute()
          hideCards()
          showLoadRemainingAssets()
          trigger('map')
        }

        // load the route from local storage, or default options
        var loadRoute = function() {
          var getItem = function(item) {
            return supportsLocalStorage
              ? localStorage.getItem(item)
              : null
          }
          var region = getItem('region') || 'districts'
          var metric = getItem('metric') || 'avg'
          var view = getItem('view') || 'map'
          var demographic = getItem('demographic') || 'all'
          var route =
            '/' +
            view +
            '/none/' +
            region +
            '/' +
            metric +
            '/ses/' +
            demographic +
            '/3.15/37.39/-96.78'
          if (!validRoute(route)) {
            route = defaultRoute
            trackProblem('tried to load invalid route')
          } else {
            trackRegion(region)
            trackMetric(metric)
            trackView(view)
            trackDemographic(demographic)
          }
          // replaceHash(route)
        }

        // updates the loading message
        var updateLoadingText = function(text) {
          var el = document.getElementById('loadingText')
          if (el) {
            el.innerHTML = text
          }
        }

        // show remaining loading messages while the map / charts load
        var showLoadRemainingAssets = function() {
          startTimeDataLoad = new Date()
          updateLoadingText('Loading maps')
          setTimeout(function() {
            updateLoadingText('Loading charts')
          }, 3000)
          setTimeout(function() {
            updateLoadingText('Loading school data')
          }, 8000)
          loadTimeout = setTimeout(function() {
            updateLoadingText('Still loading...')
            trackProblem('explorer load longer than 30 seconds')
          }, 30000)
        }

        var trackTiming = function(type, id, value) {
          if (!dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'timingEvent',
            timingType: type,
            timingId: id,
            timeValue: value
          })
        }

        var trackProblem = function(type) {
          if (!dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'problemDetected',
            problemType: type
          })
        }

        var trackRegion = function(region) {
          if (!dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'geoTypeSelected',
            geoTypeSelection: region
          })
        }

        var trackMetric = function(metric) {
          if (!metric || !dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'metricSelected',
            metricSelection: LANG[metric.toUpperCase()] || metric
          })
        }

        var trackDemographic = function(demographic) {
          if (!demographic || !dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'studentTypeSelected',
            studentTypeSelection:
              LANG[demographic.toUpperCase()] || demographic
          })
        }

        var trackView = function(view) {
          if (!dataLayer || !dataLayer.push) {
            return
          }
          dataLayer.push({
            event: 'displayTypeSelected',
            displayTypeSelection: view
          })
        }

        // tracks the view and region for direct links
        var trackDirectLink = function() {
          var url = window.location.hash
          if (url.indexOf('/map/') !== -1) {
            trackView('map')
          }
          if (url.indexOf('/chart/') !== -1) {
            trackView('chart')
          }
          if (url.indexOf('/split/') !== -1) {
            trackView('split')
          }
          if (url.indexOf('/schools/') !== -1) {
            trackRegion('schools')
          }
          if (url.indexOf('/districts/') !== -1) {
            trackRegion('districts')
          }
          if (url.indexOf('/counties/') !== -1) {
            trackRegion('counties')
          }
          if (url.indexOf('/states/') !== -1) {
            trackRegion('states')
          }
          if (url.indexOf('/avg/') !== -1) {
            trackMetric('avg')
          }
          if (url.indexOf('/grd/') !== -1) {
            trackMetric('grd')
          }
          if (url.indexOf('/coh/') !== -1) {
            trackMetric('coh')
          }
        }

        // handler for when the 'app' event fires, indicating app assets are available
        var appLoadedHandler = function() {
          var appLoadTime = new Date()
          var appLoadSeconds = parseInt(appLoadTime - startTime)
          trackTiming('load', 'loading assets', appLoadSeconds)
          if (location.hash.length < 3) {
              // no route in local storage, show selection
              showCards()
          } else {
            console.log("hhhh")
            // route already exists, load
            trigger('map')
            if (validRoute(window.location.hash)) {
              trackDirectLink()
            } else {
              trackProblem('tried to load invalid route')
              replaceHash(defaultRoute)
            }
            showLoadRemainingAssets()
          }
          // showLoadRemainingAssets()
        }

        var getViewFromURL = function(url) {
          if (url.indexOf('/map/') > -1) {
            return 'map'
          }
          if (url.indexOf('/chart/') > -1) {
            return 'chart'
          }
          if (url.indexOf('/split/') > -1) {
            return 'split'
          }
          return 'unknown'
        }

        var getMetricFromURL = function(url) {
          if (url.indexOf('/avg/') > -1) {
            return 'avg'
          }
          if (url.indexOf('/grd/') > -1) {
            return 'grd'
          }
          if (url.indexOf('/coh/') > -1) {
            return 'coh'
          }
          return 'unknown'
        }

        var setupViewTiming = function() {
          viewTime = new Date()
          metricTime = new Date()
          currentView = getViewFromURL(window.location.hash)
          currentMetric = getMetricFromURL(window.location.hash)
          var handleHashChange = function(e) {
            var newView = getViewFromURL(e.newURL)
            var newMetric = getMetricFromURL(
              window.location.hash
            )
            if (newView !== currentView) {
              var elapsedTime = parseInt(new Date() - viewTime)
              trackTiming(
                'interaction',
                'viewing ' + currentView,
                elapsedTime
              )
              viewTime = new Date()
              currentView = newView
            }
            if (newMetric !== currentMetric) {
              var elapsedTime = parseInt(new Date() - metricTime)
              trackTiming(
                'interaction',
                'duration ' + currentMetric,
                elapsedTime
              )
              metricTime = new Date()
              currentMetric = newMetric
            }
          }
          var handleUnload = function() {
            var elapsedTime = parseInt(new Date() - viewTime)
            trackTiming(
              'interaction',
              'viewing ' + currentView,
              elapsedTime
            )
            trackTiming(
              'interaction',
              'duration ' + currentMetric,
              elapsedTime
            )
          }

          window.addEventListener(
            'hashchange',
            handleHashChange,
            false
          )
          window.addEventListener(
            'beforeunload',
            handleUnload,
            false
          )
        }

        var mapLoadHandler = function() {
          if (loadTimeout) {
            clearTimeout(loadTimeout)
          }
          var endTimeDataLoad = new Date()
          var dataLoadSeconds = parseInt(
            endTimeDataLoad - startTimeDataLoad
          )
          trackTiming(
            'load',
            'loading map data',
            dataLoadSeconds
          )
          hideIntro()
          setupViewTiming()
          setTimeout(removeIntro, 2000)
        }

        if (unsupportedBrowser()) {
          showUnsupported()
          trackProblem(
            'unsupported browser: ' +
              browser.name +
              ' ' +
              browser.version
          )
        } else {
          // bind events
          addHandler('app', appLoadedHandler)
          addHandler('map', mapLoadHandler)
        }

        // return public functions
        return {
          addHandler: addHandler,
          trigger: trigger,
          loadView: loadView,
          trackTiming: trackTiming,
          trackProblem: trackProblem
        }
      })()
    </script>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
